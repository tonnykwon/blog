---
title: "쇼핑몰 로그 데이터 고객 클러스터링"
date: 2019-07-29
categories: portfolio
mathjax: true
---

### 목적 및 업무명

수훨한 고객 관리와 고객 파악을 위해 고객 집단을 세분화하고 시간에 따른 고객 변화 분류 및 분석



### 회사

tan.D



### 기간

2019.02.18 ~ 2019.03.25



### 주요 역할

- 데이터 전처리
- 분석 방향 고안
- 분석 진행
- 분석 결과 정리 및 발표



### 세부 방법

#### 1. 기본 고객 군집화

쇼핑몰 사용자의 상품 구매 로그 데이터를 통해서 사용자를 군집화하였다. 데이터는 상품명, 행동(결제, 검색, 탐색 등), 상품의 카테고리, 세부 카테고리, 상품 수량 그리고 결제금액으로 이루어져있다. 기본적으로 고객은 충성 고객, 신규 고객, 이탈 고객 등 여러 집단으로 나누어지고, 시간에 따라 속하는 집단이 변한다고 가정했다. 군집을 나누는 방법에 따라 군집화는 밀도, 계층, 그리드 등 여러 방법이 있지만 시간에 따라 고객의 군집 이동을 보기 위해서는 군집의 중심점이 필요하다. 따라서, 중심점이 존재하는 K-means와 K-medoids 기법을 사용하였다. 군집 개수 설정에 있어서 Elbow method를 사용할 수 있지만 보다 자동화된 군집 개수 설정을 위해 Pham과 Dimov의 Selection of K in K-means clustering 논문[^1]에서 정의된 K군집 평가함수를 사용하였다. 이 군집 평가 함수는 K-n 군집화에 비하여 K 군집화가 군집간의 거리가 얼만큼 줄었는 지를 통해 K 개수의 적절함을 평가한다. 또 군집 내 데이터 거리와 군집간의 거리를 기반으로 평가하는 Silhouette Coefficient를 통하여 K를 종합적으로 평가했다.



#### 2. 시간에 따른 고객 집단을 군집화

약 5천만 로그데이터 사용하여 570만명의 사용자 중 10%를 샘플링하여 주 간 활동 데이터를 기반으로 군집화하였다. 그 이후 4주 데이터를 각 주마다 나누어 기존 학습된 군집화 모델로 분류를 진행한 뒤, 4주간의 군집 이동을 데이터로 만들었다. 이를 다시 군집화 진행하여 KPI(평균 구매 금액, 평균 체류 시간)를 기반으로 군집화된 군집을 이탈하려는 고객군인지 구매를 점점 더 하는 고객군인지 혹은 변화가 없는 고객군인지 등을 설정했다.



#### 3. 각 군집의 패턴 마이닝

각 고객 집단의 특성을 자세히 파악하기 위해서 각 집단의 행동 패턴(Sequential Pattern)을 마이닝했다. PreFixSpan을 통해 각 집단에서 나타나는 패턴을 추출했다.

<p align= 'center'>
    <img src = "../../assets/img/portfolio/2-pattern.png" width = "70%">
    <br/>
    <sub>각 군집 패턴 마이닝 샘플</sub>
</p>



### 개선점

- 가장 큰 문제점은 대부분 쇼핑몰 사용자들의 주 평균 구매 금액이나 활동 정도가 비슷하다는 것이었다. 정규화 및 로그 등 다양한 방법으로 변수들을 바꾸어주었지만 크게 군집화 결과에서 큰 차이가 나지 않았다. 다양한 군집으로 명확하게 나누어질수록 군집에 대한 차이를 확인하고 적용가능한 고객 관리방법이 다를 수 있는데 위와 같은 문제점이 큰 한계점을 가져다 주었다.



### 개발 환경 및 언어

#### 언어 및 라이브러리

Python: numpy, pandas, scikit-learn, pyspark

#### H/W 사양

프로세서: 2.6GHz 6코어 Intel Core i7

메모리: 16GB

운영체제: macOS

로컬에서 샘플링 데이터로 개발 후, 회사 서버에서 최종 모델 학습 진행



### 참조 논문

[^1]:Pham, D. T., Dimov, S. S., & Nguyen, C. D. (2005). Selection of K in K-means clustering. *Proceedings of the Institution of Mechanical Engineers, Part C: Journal of Mechanical Engineering Science*, *219*(1), 103-119.